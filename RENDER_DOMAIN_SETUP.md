# TrackAppointments Custom Domain Setup Guide

## Current Status
âœ… **Backend**: https://trackappointments-backend.onrender.com  
âœ… **Frontend**: https://trackappointments-frontend.onrender.com  
âœ… **Database**: trackappointments-db (PostgreSQL)

## Target Domain Configuration
ðŸŽ¯ **Root Domain**: `trackappointments.com` â†’ Frontend  
ðŸŽ¯ **API Subdomain**: `api.trackappointments.com` â†’ Backend

## Step 1: Configure Custom Domains in Render Dashboard

### Frontend Service (trackappointments-frontend)
1. Go to Render Dashboard â†’ Services â†’ trackappointments-frontend
2. Click "Settings" tab
3. Scroll to "Custom Domains" section
4. Click "Add Custom Domain"
5. Enter: `trackappointments.com`
6. Save changes

### Backend Service (trackappointments-backend)  
1. Go to Render Dashboard â†’ Services â†’ trackappointments-backend
2. Click "Settings" tab
3. Scroll to "Custom Domains" section
4. Click "Add Custom Domain"
5. Enter: `api.trackappointments.com`
6. Save changes

## Step 2: DNS Configuration (Cloudflare)

Based on current ngrok setup, you're using Cloudflare for DNS. Configure these records:

### DNS Records to ADD/UPDATE:
```
Type: A
Name: trackappointments.com (root)
Value: 216.24.57.1 (Render's load balancer IP)
TTL: Auto

Type: CNAME  
Name: api
Value: trackappointments-backend.onrender.com
TTL: Auto

Type: CNAME
Name: www
Value: trackappointments.com
TTL: Auto
```

### DNS Records to REMOVE:
- Remove existing ngrok CNAME records
- Remove any AAAA (IPv6) records for trackappointments.com
- Remove conflicting A records pointing to ngrok IPs

## Step 3: Update Frontend API Configuration

Update the frontend to use the new API subdomain:

### File: `/frontend/next.config.js`
```javascript
env: {
  NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL || 'https://api.trackappointments.com',
},
```

### File: `/render.yaml`
```yaml
- type: web
  name: trackappointments-frontend
  env: node
  plan: standard
  region: oregon
  repo: https://github.com/c50bossio/trackappointments-attribution-tracker.git
  rootDir: frontend
  buildCommand: npm install && npm run build
  startCommand: npm start
  envVars:
    - key: NEXT_PUBLIC_API_URL
      value: https://api.trackappointments.com  # Updated
```

## Step 4: Verification Checklist

After DNS propagation (5-30 minutes):

- [ ] `https://trackappointments.com` loads frontend âœ…
- [ ] `https://api.trackappointments.com` shows API response âœ…
- [ ] `https://api.trackappointments.com/health` returns healthy status âœ…
- [ ] Frontend dashboard connects to API successfully âœ…
- [ ] SSL certificates auto-generated by Render âœ…
- [ ] OAuth flows work with new domain âœ…

## Step 5: Production Environment Variables

### Backend Environment Updates
```bash
# Update backend environment (if needed)
CORS_ORIGINS=https://trackappointments.com,https://www.trackappointments.com
ALLOWED_HOSTS=api.trackappointments.com,trackappointments-backend.onrender.com
```

## Step 6: Final Testing

1. **Frontend Loading**: Visit https://trackappointments.com
2. **API Health**: Visit https://api.trackappointments.com/health  
3. **Dashboard Integration**: Test OAuth connections at https://trackappointments.com/dashboard
4. **SSL Verification**: Ensure both domains show valid SSL certificates

## Notes
- Render automatically provides SSL certificates for custom domains
- Both .onrender.com domains remain accessible as backups
- DNS propagation may take 5-30 minutes globally
- Render's load balancer IP: 216.24.57.1 (for A records)

## Rollback Plan
If issues occur, temporarily revert DNS to point back to ngrok while debugging.