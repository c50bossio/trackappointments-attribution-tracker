<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookingBridge API Demo & Testing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2563eb">
    <style>
        .fade-in { animation: fadeIn 0.8s ease-out; }
        .slide-up { animation: slideUp 0.6s ease-out; }
        .bounce-in { animation: bounceIn 0.8s ease-out; }
        .pulse { animation: pulse 2s infinite; }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(40px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .json-output {
            background: #1a1a1a;
            color: #f8f8f2;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .status-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .status-error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .status-loading { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 antialiased">
    <div id="app">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b border-gray-200 bounce-in">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center shadow-lg hover-lift">
                            <span class="text-white font-bold text-lg">BB</span>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold gradient-text">BookingBridge API Demo</h1>
                            <p class="text-sm text-gray-500">Interactive API testing and documentation</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="/" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Back to Dashboard
                        </a>
                        <a href="http://localhost:8001/docs" target="_blank" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            OpenAPI Docs
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- API Testing Section -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 fade-in">
                <h2 class="text-2xl font-bold gradient-text mb-6">Interactive API Testing</h2>
                
                <!-- API Endpoint Selector -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select API Endpoint</label>
                    <select id="endpoint-selector" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">-- Select an endpoint --</option>
                        <option value="health">Health Check (GET /api/health)</option>
                        <option value="dashboard">Dashboard Data (GET /api/v1/analytics/dashboard)</option>
                        <option value="attribution-models">Attribution Models (GET /api/v1/analytics/attribution-models)</option>
                        <option value="campaign-performance">Campaign Performance (GET /api/v1/analytics/campaign-performance)</option>
                        <option value="real-time-metrics">Real-time Metrics (GET /api/v1/analytics/real-time-metrics)</option>
                        <option value="integrations-status">Integrations Status (GET /api/v1/integrations/status)</option>
                        <option value="track-interaction">Track Interaction (POST /api/v1/track/interaction)</option>
                        <option value="track-booking">Track Booking (POST /api/v1/track/booking)</option>
                        <option value="optimize-campaigns">Optimize Campaigns (POST /api/v1/campaigns/optimize)</option>
                    </select>
                </div>

                <!-- Request Configuration -->
                <div id="request-config" class="hidden mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Request Configuration</h3>
                    <div id="request-method" class="mb-4"></div>
                    <div id="request-body" class="hidden mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Request Body (JSON)</label>
                        <textarea id="json-input" class="w-full h-40 px-4 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter JSON request body..."></textarea>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="test-btn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                            <span class="flex items-center">
                                <span id="test-btn-text">Test API</span>
                                <div id="loading-spinner" class="hidden ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full loading-spinner"></div>
                            </span>
                        </button>
                        <button id="clear-btn" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">Clear</button>
                        <div id="status-indicator" class="hidden px-3 py-1 rounded-full text-xs font-medium text-white"></div>
                    </div>
                </div>

                <!-- Response Display -->
                <div id="response-section" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">API Response</h3>
                    <div class="border border-gray-300 rounded-lg overflow-hidden">
                        <div class="bg-gray-800 text-white px-4 py-2 text-sm font-medium flex justify-between items-center">
                            <span>Response</span>
                            <span id="response-status" class="px-2 py-1 rounded text-xs"></span>
                        </div>
                        <pre id="response-body" class="json-output p-4 text-sm overflow-x-auto max-h-96"></pre>
                    </div>
                </div>
            </div>

            <!-- Sample Requests Documentation -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 fade-in">
                <h2 class="text-2xl font-bold gradient-text mb-6">Sample API Requests</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Track Interaction Sample -->
                    <div class="bg-gray-50 rounded-xl p-6 hover-lift">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">ðŸ“Š Track Interaction</h3>
                        <p class="text-gray-600 mb-4">Track user interactions from ad platforms for attribution matching.</p>
                        <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                            <pre><code>{
  "business_id": "business-demo-001",
  "interaction_type": "ad_click",
  "source": "facebook_ads",
  "campaign_id": "camp-facebook-001",
  "user_identifier": "hashed-user-id-123"
}</code></pre>
                        </div>
                        <button class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm" onclick="loadSampleRequest('track-interaction')">
                            Load Sample
                        </button>
                    </div>

                    <!-- Track Booking Sample -->
                    <div class="bg-gray-50 rounded-xl p-6 hover-lift">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">ðŸ’° Track Booking</h3>
                        <p class="text-gray-600 mb-4">Track booking conversions and trigger attribution matching.</p>
                        <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                            <pre><code>{
  "business_id": "business-demo-001",
  "booking_id": "booking-12345",
  "user_identifier": "hashed-user-id-123",
  "service_type": "haircut_premium",
  "booking_value": 85.0,
  "platform": "square"
}</code></pre>
                        </div>
                        <button class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm" onclick="loadSampleRequest('track-booking')">
                            Load Sample
                        </button>
                    </div>

                    <!-- Campaign Optimization Sample -->
                    <div class="bg-gray-50 rounded-xl p-6 hover-lift">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">ðŸš€ Campaign Optimization</h3>
                        <p class="text-gray-600 mb-4">Get ML-powered campaign optimization recommendations.</p>
                        <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                            <pre><code>{
  "business_id": "business-demo-001",
  "campaign_ids": [
    "camp-facebook-001",
    "camp-google-002"
  ],
  "optimization_goal": "conversions",
  "time_range_days": 7
}</code></pre>
                        </div>
                        <button class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm" onclick="loadSampleRequest('optimize-campaigns')">
                            Load Sample
                        </button>
                    </div>

                    <!-- Real-time Metrics -->
                    <div class="bg-gray-50 rounded-xl p-6 hover-lift">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">âš¡ Real-time Metrics</h3>
                        <p class="text-gray-600 mb-4">Get live platform performance metrics and system health.</p>
                        <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                            <pre><code>GET /api/v1/analytics/real-time-metrics

// Returns live metrics including:
// - Active sessions
// - Attribution matches per hour  
// - Revenue recovered today
// - System performance data</code></pre>
                        </div>
                        <button class="mt-4 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm" onclick="loadSampleRequest('real-time-metrics')">
                            Load Sample
                        </button>
                    </div>
                </div>
            </div>

            <!-- API Features Overview -->
            <div class="bg-white rounded-2xl shadow-xl p-8 fade-in">
                <h2 class="text-2xl font-bold gradient-text mb-6">API Features & Capabilities</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-blue-50 rounded-xl p-6">
                        <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-white text-xl">ðŸŽ¯</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Advanced Attribution</h3>
                        <p class="text-gray-600 text-sm">5 attribution models including ML-enhanced with 96.7% accuracy</p>
                    </div>
                    
                    <div class="bg-green-50 rounded-xl p-6">
                        <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-white text-xl">âš¡</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Real-time Processing</h3>
                        <p class="text-gray-600 text-sm">Sub-50ms attribution matching with live metrics streaming</p>
                    </div>
                    
                    <div class="bg-purple-50 rounded-xl p-6">
                        <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-white text-xl">ðŸ¤–</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">ML Optimization</h3>
                        <p class="text-gray-600 text-sm">AI-powered campaign recommendations with ROI predictions</p>
                    </div>
                    
                    <div class="bg-yellow-50 rounded-xl p-6">
                        <div class="w-12 h-12 bg-yellow-600 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-white text-xl">ðŸ”—</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Platform Integrations</h3>
                        <p class="text-gray-600 text-sm">15+ integrations including Facebook, Google Ads, Square, Booksy</p>
                    </div>
                    
                    <div class="bg-red-50 rounded-xl p-6">
                        <div class="w-12 h-12 bg-red-600 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-white text-xl">ðŸ”’</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Privacy Compliant</h3>
                        <p class="text-gray-600 text-sm">GDPR compliant with privacy-safe identifiers and encryption</p>
                    </div>
                    
                    <div class="bg-indigo-50 rounded-xl p-6">
                        <div class="w-12 h-12 bg-indigo-600 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-white text-xl">ðŸ“Š</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Enterprise Analytics</h3>
                        <p class="text-gray-600 text-sm">Comprehensive reporting with campaign performance insights</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // API URL configuration
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:8001' 
            : window.location.protocol + '//' + window.location.hostname + ':8001';

        // Endpoint configurations
        const endpoints = {
            'health': {
                method: 'GET',
                url: '/api/health',
                body: null
            },
            'dashboard': {
                method: 'GET',
                url: '/api/v1/analytics/dashboard',
                body: null
            },
            'attribution-models': {
                method: 'GET',
                url: '/api/v1/analytics/attribution-models',
                body: null
            },
            'campaign-performance': {
                method: 'GET',
                url: '/api/v1/analytics/campaign-performance',
                body: null
            },
            'real-time-metrics': {
                method: 'GET',
                url: '/api/v1/analytics/real-time-metrics',
                body: null
            },
            'integrations-status': {
                method: 'GET',
                url: '/api/v1/integrations/status',
                body: null
            },
            'track-interaction': {
                method: 'POST',
                url: '/api/v1/track/interaction',
                body: {
                    "business_id": "business-demo-001",
                    "interaction_type": "ad_click",
                    "source": "facebook_ads",
                    "campaign_id": "camp-facebook-001",
                    "user_identifier": "hashed-user-id-123"
                }
            },
            'track-booking': {
                method: 'POST',
                url: '/api/v1/track/booking',
                body: {
                    "business_id": "business-demo-001",
                    "booking_id": "booking-12345",
                    "user_identifier": "hashed-user-id-123",
                    "service_type": "haircut_premium",
                    "booking_value": 85.0,
                    "platform": "square"
                }
            },
            'optimize-campaigns': {
                method: 'POST',
                url: '/api/v1/campaigns/optimize',
                body: {
                    "business_id": "business-demo-001",
                    "campaign_ids": ["camp-facebook-001", "camp-google-002"],
                    "optimization_goal": "conversions",
                    "time_range_days": 7
                }
            }
        };

        // Sample requests for quick loading
        const sampleRequests = {
            'track-interaction': {
                endpoint: 'track-interaction',
                body: endpoints['track-interaction'].body
            },
            'track-booking': {
                endpoint: 'track-booking', 
                body: endpoints['track-booking'].body
            },
            'optimize-campaigns': {
                endpoint: 'optimize-campaigns',
                body: endpoints['optimize-campaigns'].body
            },
            'real-time-metrics': {
                endpoint: 'real-time-metrics',
                body: null
            }
        };

        // DOM elements
        const endpointSelector = document.getElementById('endpoint-selector');
        const requestConfig = document.getElementById('request-config');
        const requestMethod = document.getElementById('request-method');
        const requestBody = document.getElementById('request-body');
        const jsonInput = document.getElementById('json-input');
        const testBtn = document.getElementById('test-btn');
        const clearBtn = document.getElementById('clear-btn');
        const loadingSpinner = document.getElementById('loading-spinner');
        const testBtnText = document.getElementById('test-btn-text');
        const statusIndicator = document.getElementById('status-indicator');
        const responseSection = document.getElementById('response-section');
        const responseStatus = document.getElementById('response-status');
        const responseBody = document.getElementById('response-body');

        // Event listeners
        endpointSelector.addEventListener('change', handleEndpointChange);
        testBtn.addEventListener('click', handleApiTest);
        clearBtn.addEventListener('click', handleClear);

        function handleEndpointChange() {
            const selectedEndpoint = endpointSelector.value;
            
            if (!selectedEndpoint) {
                requestConfig.classList.add('hidden');
                responseSection.classList.add('hidden');
                return;
            }

            const config = endpoints[selectedEndpoint];
            
            // Show request configuration
            requestConfig.classList.remove('hidden');
            
            // Update method display
            requestMethod.innerHTML = `
                <span class="inline-block px-3 py-1 rounded-full text-xs font-medium text-white ${config.method === 'GET' ? 'bg-blue-600' : 'bg-green-600'}">
                    ${config.method}
                </span>
                <span class="ml-2 font-mono text-sm">${API_URL}${config.url}</span>
            `;
            
            // Show/hide request body
            if (config.body) {
                requestBody.classList.remove('hidden');
                jsonInput.value = JSON.stringify(config.body, null, 2);
            } else {
                requestBody.classList.add('hidden');
                jsonInput.value = '';
            }
        }

        function loadSampleRequest(sampleType) {
            const sample = sampleRequests[sampleType];
            if (sample) {
                endpointSelector.value = sample.endpoint;
                handleEndpointChange();
                if (sample.body) {
                    jsonInput.value = JSON.stringify(sample.body, null, 2);
                }
            }
        }

        async function handleApiTest() {
            const selectedEndpoint = endpointSelector.value;
            if (!selectedEndpoint) return;

            const config = endpoints[selectedEndpoint];
            
            // Show loading state
            testBtn.disabled = true;
            loadingSpinner.classList.remove('hidden');
            testBtnText.textContent = 'Testing...';
            statusIndicator.classList.remove('hidden');
            statusIndicator.className = 'px-3 py-1 rounded-full text-xs font-medium text-white status-loading';
            statusIndicator.textContent = 'Loading...';
            
            try {
                // Prepare request options
                const requestOptions = {
                    method: config.method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                // Add body for POST requests
                if (config.method === 'POST') {
                    try {
                        const bodyText = jsonInput.value.trim();
                        if (bodyText) {
                            requestOptions.body = bodyText;
                        }
                    } catch (e) {
                        throw new Error('Invalid JSON in request body');
                    }
                }

                // Make API request
                const response = await fetch(`${API_URL}${config.url}`, requestOptions);
                const responseData = await response.json();
                
                // Display response
                responseSection.classList.remove('hidden');
                responseStatus.textContent = `${response.status} ${response.statusText}`;
                responseStatus.className = `px-2 py-1 rounded text-xs ${response.ok ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`;
                responseBody.textContent = JSON.stringify(responseData, null, 2);
                
                // Update status indicator
                if (response.ok) {
                    statusIndicator.className = 'px-3 py-1 rounded-full text-xs font-medium text-white status-success';
                    statusIndicator.textContent = 'Success';
                } else {
                    statusIndicator.className = 'px-3 py-1 rounded-full text-xs font-medium text-white status-error';
                    statusIndicator.textContent = 'Error';
                }
                
            } catch (error) {
                // Display error
                responseSection.classList.remove('hidden');
                responseStatus.textContent = 'Network Error';
                responseStatus.className = 'px-2 py-1 rounded text-xs bg-red-600 text-white';
                responseBody.textContent = JSON.stringify({
                    error: error.message,
                    timestamp: new Date().toISOString()
                }, null, 2);
                
                statusIndicator.className = 'px-3 py-1 rounded-full text-xs font-medium text-white status-error';
                statusIndicator.textContent = 'Error';
            } finally {
                // Reset loading state
                testBtn.disabled = false;
                loadingSpinner.classList.add('hidden');
                testBtnText.textContent = 'Test API';
            }
        }

        function handleClear() {
            endpointSelector.value = '';
            requestConfig.classList.add('hidden');
            responseSection.classList.add('hidden');
            statusIndicator.classList.add('hidden');
            jsonInput.value = '';
        }

        // Make loadSampleRequest globally available
        window.loadSampleRequest = loadSampleRequest;
    </script>
</body>
</html>